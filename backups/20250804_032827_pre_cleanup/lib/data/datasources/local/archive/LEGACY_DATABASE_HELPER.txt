import 'package:sqflite/sqflite.dart';
import 'package:path/path.dart';
import 'package:spots/core/models/spot.dart';
import 'package:spots/core/models/list.dart' as app_list;
import 'package:spots/core/models/user.dart' as app_user;

class DatabaseHelper {
  static final DatabaseHelper _instance = DatabaseHelper._internal();
  static Database? _database;

  factory DatabaseHelper() => _instance;
  DatabaseHelper._internal();

  Future<Database> get database async {
    if (_database != null) return _database!;
    _database = await _initDatabase();
    return _database!;
  }

  Future<Database> _initDatabase() async {
    String path = join(await getDatabasesPath(), 'spots.db');
    return await openDatabase(
      path,
      version: 1,
      onCreate: _onCreate,
    );
  }

  Future<void> _onCreate(Database db, int version) async {
    // Users table
    await db.execute('''
      CREATE TABLE users (
        id TEXT PRIMARY KEY,
        name TEXT NOT NULL,
        email TEXT NOT NULL,
        isOnline INTEGER NOT NULL DEFAULT 1,
        createdAt TEXT NOT NULL
      )
    ''');

    // Spots table
    await db.execute('''
      CREATE TABLE spots (
        id TEXT PRIMARY KEY,
        name TEXT NOT NULL,
        description TEXT,
        category TEXT NOT NULL,
        latitude REAL NOT NULL,
        longitude REAL NOT NULL,
        address TEXT,
        rating REAL DEFAULT 0.0,
        createdBy TEXT NOT NULL,
        createdAt TEXT NOT NULL,
        updatedAt TEXT NOT NULL,
        FOREIGN KEY (createdBy) REFERENCES users (id)
      )
    ''');

    // Lists table
    await db.execute('''
      CREATE TABLE lists (
        id TEXT PRIMARY KEY,
        name TEXT NOT NULL,
        description TEXT,
        createdBy TEXT NOT NULL,
        createdAt TEXT NOT NULL,
        updatedAt TEXT NOT NULL,
        FOREIGN KEY (createdBy) REFERENCES users (id)
      )
    ''');

    // List_Spots junction table
    await db.execute('''
      CREATE TABLE list_spots (
        listId TEXT NOT NULL,
        spotId TEXT NOT NULL,
        PRIMARY KEY (listId, spotId),
        FOREIGN KEY (listId) REFERENCES lists (id),
        FOREIGN KEY (spotId) REFERENCES spots (id)
      )
    ''');
  }

  // ... (rest of the DatabaseHelper methods)
} 